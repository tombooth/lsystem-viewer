/*! lsystem-viewer 18-04-2013 */
(function(){function t(t){if(this._element=t,t.className!=this.classCache){this._classCache=t.className;var e,n=this._classCache.split(" ");for(e=0;n.length>e;e++)o.call(this,n[e])}}function e(t,e){t.className=e.join(" ")}function n(t,e,n){Object.defineProperty?Object.defineProperty(t,e,{get:n}):t.__defineGetter__(e,n)}if(!("undefined"==typeof Element||"classList"in document.documentElement)){var i=[].indexOf,r=[].slice,o=[].push,s=[].splice,a=[].join;t.prototype={add:function(t){o.call(this,t),e(this._element,r.call(this,0))},contains:function(t){return-1!==i.call(this,t)},item:function(t){return this[t]||null},remove:function(t){var n=i.call(this,t);-1!==n&&(s.call(this,n,1),e(this._element,r.call(this,0)))},toString:function(){return a.call(this," ")},toggle:function(t){-1===i.call(this,t)?this.add(t):this.remove(t)}},window.DOMTokenList=t,n(Element.prototype,"classList",function(){return new t(this)})}})(),function(t){"function"==typeof define?define(t):"function"==typeof YUI?YUI.add("es5-sham",t):t()}(function(){function t(t){try{return Object.defineProperty(t,"sentinel",{}),"sentinel"in t}catch(e){}}var e,n,i,r,o,s=Function.prototype.call,a=Object.prototype,c=s.bind(a.hasOwnProperty);if((o=c(a,"__defineGetter__"))&&(e=s.bind(a.__defineGetter__),n=s.bind(a.__defineSetter__),i=s.bind(a.__lookupGetter__),r=s.bind(a.__lookupSetter__)),Object.getPrototypeOf||(Object.getPrototypeOf=function(t){return t.__proto__||(t.constructor?t.constructor.prototype:a)}),!Object.getOwnPropertyDescriptor){var l="Object.getOwnPropertyDescriptor called on a non-object: ";Object.getOwnPropertyDescriptor=function(t,e){if("object"!=typeof t&&"function"!=typeof t||null===t)throw new TypeError(l+t);if(c(t,e)){var n={enumerable:!0,configurable:!0};if(o){var s=t.__proto__;t.__proto__=a;var u=i(t,e),h=r(t,e);if(t.__proto__=s,u||h)return u&&(n.get=u),h&&(n.set=h),n}return n.value=t[e],n}}}if(Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(t){return Object.keys(t)}),!Object.create){var u,h=null===Object.prototype.__proto__;u=h||"undefined"==typeof document?function(){return{__proto__:null}}:function(){function t(){}var e=document.createElement("iframe"),n=document.body||document.documentElement;e.style.display="none",n.appendChild(e),e.src="javascript:";var i=e.contentWindow.Object.prototype;return n.removeChild(e),e=null,delete i.constructor,delete i.hasOwnProperty,delete i.propertyIsEnumerable,delete i.isPrototypeOf,delete i.toLocaleString,delete i.toString,delete i.valueOf,i.__proto__=null,t.prototype=i,function(){return new t}}(),Object.create=function(t,e){function n(){}var i;if(null===t)i=u();else{if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object prototype may only be an Object or null");n.prototype=t,i=new n,i.__proto__=t}return void 0!==e&&Object.defineProperties(i,e),i}}if(Object.defineProperty){var p=t({}),f="undefined"==typeof document||t(document.createElement("div"));if(!p||!f)var d=Object.defineProperty,y=Object.defineProperties}if(!Object.defineProperty||d){var m="Property description must be an object: ",g="Object.defineProperty called on non-object: ",_="getters & setters can not be defined on this javascript engine";Object.defineProperty=function(t,s,l){if("object"!=typeof t&&"function"!=typeof t||null===t)throw new TypeError(g+t);if("object"!=typeof l&&"function"!=typeof l||null===l)throw new TypeError(m+l);if(d)try{return d.call(Object,t,s,l)}catch(u){}if(c(l,"value"))if(o&&(i(t,s)||r(t,s))){var h=t.__proto__;t.__proto__=a,delete t[s],t[s]=l.value,t.__proto__=h}else t[s]=l.value;else{if(!o)throw new TypeError(_);c(l,"get")&&e(t,s,l.get),c(l,"set")&&n(t,s,l.set)}return t}}(!Object.defineProperties||y)&&(Object.defineProperties=function(t,e){if(y)try{return y.call(Object,t,e)}catch(n){}for(var i in e)c(e,i)&&"__proto__"!=i&&Object.defineProperty(t,i,e[i]);return t}),Object.seal||(Object.seal=function(t){return t}),Object.freeze||(Object.freeze=function(t){return t});try{Object.freeze(function(){})}catch(v){Object.freeze=function(t){return function(e){return"function"==typeof e?e:t(e)}}(Object.freeze)}Object.preventExtensions||(Object.preventExtensions=function(t){return t}),Object.isSealed||(Object.isSealed=function(){return!1}),Object.isFrozen||(Object.isFrozen=function(){return!1}),Object.isExtensible||(Object.isExtensible=function(t){if(Object(t)!==t)throw new TypeError;for(var e="";c(t,e);)e+="?";t[e]=!0;var n=c(t,e);return delete t[e],n})}),function(t){"function"==typeof define?define(t):"function"==typeof YUI?YUI.add("es5",t):t()}(function(){function t(){}function e(t){return t=+t,t!==t?t=0:0!==t&&t!==1/0&&t!==-(1/0)&&(t=(t>0||-1)*Math.floor(Math.abs(t))),t}function n(t){var e=typeof t;return null===t||"undefined"===e||"boolean"===e||"number"===e||"string"===e}function i(t){var e,i,r;if(n(t))return t;if(i=t.valueOf,"function"==typeof i&&(e=i.call(t),n(e)))return e;if(r=t.toString,"function"==typeof r&&(e=r.call(t),n(e)))return e;throw new TypeError}Function.prototype.bind||(Function.prototype.bind=function(e){var n=this;if("function"!=typeof n)throw new TypeError("Function.prototype.bind called on incompatible "+n);var i=p.call(arguments,1),r=function(){if(this instanceof r){var t=n.apply(this,i.concat(p.call(arguments)));return Object(t)===t?t:this}return n.apply(e,i.concat(p.call(arguments)))};return n.prototype&&(t.prototype=n.prototype,r.prototype=new t,t.prototype=null),r});var r,o,s,a,c,l=Function.prototype.call,u=Array.prototype,h=Object.prototype,p=u.slice,f=l.bind(h.toString),d=l.bind(h.hasOwnProperty);if((c=d(h,"__defineGetter__"))&&(r=l.bind(h.__defineGetter__),o=l.bind(h.__defineSetter__),s=l.bind(h.__lookupGetter__),a=l.bind(h.__lookupSetter__)),2!=[1,2].splice(0).length){var y=Array.prototype.splice;Array.prototype.splice=function(t,e){return arguments.length?y.apply(this,[void 0===t?0:t,void 0===e?this.length-t:e].concat(p.call(arguments,2))):[]}}if(1!=[].unshift(0)){var m=Array.prototype.unshift;Array.prototype.unshift=function(){return m.apply(this,arguments),this.length}}Array.isArray||(Array.isArray=function(t){return"[object Array]"==f(t)});var g=Object("a"),_="a"!=g[0]||!(0 in g);if(Array.prototype.forEach||(Array.prototype.forEach=function(t){var e=P(this),n=_&&"[object String]"==f(this)?this.split(""):e,i=arguments[1],r=-1,o=n.length>>>0;if("[object Function]"!=f(t))throw new TypeError;for(;o>++r;)r in n&&t.call(i,n[r],r,e)}),Array.prototype.map||(Array.prototype.map=function(t){var e=P(this),n=_&&"[object String]"==f(this)?this.split(""):e,i=n.length>>>0,r=Array(i),o=arguments[1];if("[object Function]"!=f(t))throw new TypeError(t+" is not a function");for(var s=0;i>s;s++)s in n&&(r[s]=t.call(o,n[s],s,e));return r}),Array.prototype.filter||(Array.prototype.filter=function(t){var e,n=P(this),i=_&&"[object String]"==f(this)?this.split(""):n,r=i.length>>>0,o=[],s=arguments[1];if("[object Function]"!=f(t))throw new TypeError(t+" is not a function");for(var a=0;r>a;a++)a in i&&(e=i[a],t.call(s,e,a,n)&&o.push(e));return o}),Array.prototype.every||(Array.prototype.every=function(t){var e=P(this),n=_&&"[object String]"==f(this)?this.split(""):e,i=n.length>>>0,r=arguments[1];if("[object Function]"!=f(t))throw new TypeError(t+" is not a function");for(var o=0;i>o;o++)if(o in n&&!t.call(r,n[o],o,e))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(t){var e=P(this),n=_&&"[object String]"==f(this)?this.split(""):e,i=n.length>>>0,r=arguments[1];if("[object Function]"!=f(t))throw new TypeError(t+" is not a function");for(var o=0;i>o;o++)if(o in n&&t.call(r,n[o],o,e))return!0;return!1}),Array.prototype.reduce||(Array.prototype.reduce=function(t){var e=P(this),n=_&&"[object String]"==f(this)?this.split(""):e,i=n.length>>>0;if("[object Function]"!=f(t))throw new TypeError(t+" is not a function");if(!i&&1==arguments.length)throw new TypeError("reduce of empty array with no initial value");var r,o=0;if(arguments.length>=2)r=arguments[1];else for(;;){if(o in n){r=n[o++];break}if(++o>=i)throw new TypeError("reduce of empty array with no initial value")}for(;i>o;o++)o in n&&(r=t.call(void 0,r,n[o],o,e));return r}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(t){var e=P(this),n=_&&"[object String]"==f(this)?this.split(""):e,i=n.length>>>0;if("[object Function]"!=f(t))throw new TypeError(t+" is not a function");if(!i&&1==arguments.length)throw new TypeError("reduceRight of empty array with no initial value");var r,o=i-1;if(arguments.length>=2)r=arguments[1];else for(;;){if(o in n){r=n[o--];break}if(0>--o)throw new TypeError("reduceRight of empty array with no initial value")}do o in this&&(r=t.call(void 0,r,n[o],o,e));while(o--);return r}),Array.prototype.indexOf&&-1==[0,1].indexOf(1,2)||(Array.prototype.indexOf=function(t){var n=_&&"[object String]"==f(this)?this.split(""):P(this),i=n.length>>>0;if(!i)return-1;var r=0;for(arguments.length>1&&(r=e(arguments[1])),r=r>=0?r:Math.max(0,i+r);i>r;r++)if(r in n&&n[r]===t)return r;return-1}),Array.prototype.lastIndexOf&&-1==[0,1].lastIndexOf(0,-3)||(Array.prototype.lastIndexOf=function(t){var n=_&&"[object String]"==f(this)?this.split(""):P(this),i=n.length>>>0;if(!i)return-1;var r=i-1;for(arguments.length>1&&(r=Math.min(r,e(arguments[1]))),r=r>=0?r:i-Math.abs(r);r>=0;r--)if(r in n&&t===n[r])return r;return-1}),!Object.keys){var v=!0,b=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],w=b.length;for(var O in{toString:null})v=!1;Object.keys=function(t){if("object"!=typeof t&&"function"!=typeof t||null===t)throw new TypeError("Object.keys called on a non-object");var e=[];for(var n in t)d(t,n)&&e.push(n);if(v)for(var i=0,r=w;r>i;i++){var o=b[i];d(t,o)&&e.push(o)}return e}}var T=-621987552e5,j="-000001";Date.prototype.toISOString&&-1!==new Date(T).toISOString().indexOf(j)||(Date.prototype.toISOString=function(){var t,e,n,i,r;if(!isFinite(this))throw new RangeError("Date.prototype.toISOString called on non-finite value.");for(i=this.getUTCFullYear(),r=this.getUTCMonth(),i+=Math.floor(r/12),r=(r%12+12)%12,t=[r+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()],i=(0>i?"-":i>9999?"+":"")+("00000"+Math.abs(i)).slice(i>=0&&9999>=i?-4:-6),e=t.length;e--;)n=t[e],10>n&&(t[e]="0"+n);return i+"-"+t.slice(0,2).join("-")+"T"+t.slice(2).join(":")+"."+("000"+this.getUTCMilliseconds()).slice(-3)+"Z"});var S=!1;try{S=Date.prototype.toJSON&&null===new Date(0/0).toJSON()&&-1!==new Date(T).toJSON().indexOf(j)&&Date.prototype.toJSON.call({toISOString:function(){return!0}})}catch(L){}if(S||(Date.prototype.toJSON=function(){var t,e=Object(this),n=i(e);if("number"==typeof n&&!isFinite(n))return null;if(t=e.toISOString,"function"!=typeof t)throw new TypeError("toISOString property is not callable");return t.call(e)}),Date=function(t){function e(n,i,r,o,s,a,c){var l=arguments.length;if(this instanceof t){var u=1==l&&n+""===n?new t(e.parse(n)):l>=7?new t(n,i,r,o,s,a,c):l>=6?new t(n,i,r,o,s,a):l>=5?new t(n,i,r,o,s):l>=4?new t(n,i,r,o):l>=3?new t(n,i,r):l>=2?new t(n,i):l>=1?new t(n):new t;return u.constructor=e,u}return t.apply(this,arguments)}function n(t,e){var n=e>1?1:0;return r[e]+Math.floor((t-1969+n)/4)-Math.floor((t-1901+n)/100)+Math.floor((t-1601+n)/400)+365*(t-1970)}var i=RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:\\.(\\d{3}))?)?(Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$"),r=[0,31,59,90,120,151,181,212,243,273,304,334,365];for(var o in t)e[o]=t[o];return e.now=t.now,e.UTC=t.UTC,e.prototype=t.prototype,e.prototype.constructor=e,e.parse=function(e){var r=i.exec(e);if(r){var o,s=Number(r[1]),a=Number(r[2]||1)-1,c=Number(r[3]||1)-1,l=Number(r[4]||0),u=Number(r[5]||0),h=Number(r[6]||0),p=Number(r[7]||0),f=!r[4]||r[8]?0:Number(new t(1970,0)),d="-"===r[9]?1:-1,y=Number(r[10]||0),m=Number(r[11]||0);return(u>0||h>0||p>0?24:25)>l&&60>u&&60>h&&1e3>p&&a>-1&&12>a&&24>y&&60>m&&c>-1&&n(s,a+1)-n(s,a)>c&&(o=60*(24*(n(s,a)+c)+l+y*d),o=1e3*(60*(o+u+m*d)+h)+p+f,o>=-864e13&&864e13>=o)?o:0/0}return t.parse.apply(this,arguments)},e}(Date),Date.now||(Date.now=function(){return(new Date).getTime()}),"0".split(void 0,0).length){var x=String.prototype.split;String.prototype.split=function(t,e){return void 0===t&&0===e?[]:x.apply(this,arguments)}}if("".substr&&"b"!=="0b".substr(-1)){var E=String.prototype.substr;String.prototype.substr=function(t,e){return E.call(this,0>t?0>(t=this.length+t)?0:t:t,e)}}var k="	\n\f\r   ᠎             　\u2028\u2029﻿";if(!String.prototype.trim||k.trim()){k="["+k+"]";var A=RegExp("^"+k+k+"*"),C=RegExp(k+k+"*$");String.prototype.trim=function(){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");return(this+"").replace(A,"").replace(C,"")}}var P=function(t){if(null==t)throw new TypeError("can't convert "+t+" to object");return Object(t)}}),function(){window.L={turtle:{}}}(),function(t){function e(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}function n(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}t.math={},t.math.degToRad=function(t){return t*(Math.PI/180)},t.math.rotationMatrixUp=function(t){return[[Math.cos(t),-Math.sin(t),0],[Math.sin(t),Math.cos(t),0],[0,0,1]]},t.math.rotationMatrixLeft=function(t){return[[Math.cos(t),0,Math.sin(t)],[0,1,0],[-Math.sin(t),0,Math.cos(t)]]},t.math.rotationMatrixHeading=function(t){return[[1,0,0],[0,Math.cos(t),Math.sin(t)],[0,-Math.sin(t),Math.cos(t)]]},t.math.matrixMult=function(t,e){var n=[[0,0,0],[0,0,0],[0,0,0]];return n[0][0]=t[0][0]*e[0][0]+t[1][0]*e[0][1]+t[2][0]*e[0][2],n[0][1]=t[0][1]*e[0][0]+t[1][1]*e[0][1]+t[2][1]*e[0][2],n[0][2]=t[0][2]*e[0][0]+t[1][2]*e[0][1]+t[2][2]*e[0][2],n[1][0]=t[0][0]*e[1][0]+t[1][0]*e[1][1]+t[2][0]*e[1][2],n[1][1]=t[0][1]*e[1][0]+t[1][1]*e[1][1]+t[2][1]*e[1][2],n[1][2]=t[0][2]*e[1][0]+t[1][2]*e[1][1]+t[2][2]*e[1][2],n[2][0]=t[0][0]*e[2][0]+t[1][0]*e[2][1]+t[2][0]*e[2][2],n[2][1]=t[0][1]*e[2][0]+t[1][1]*e[2][1]+t[2][1]*e[2][2],n[2][2]=t[0][2]*e[2][0]+t[1][2]*e[2][1]+t[2][2]*e[2][2],n},t.math.absCrossProduct=function(t,i){var r=e(t),o=e(i),s=Math.acos(n(t,i)/(r*o));return r*o*Math.sin(s)}}(L),function(t){function e(){}e.prototype.step=function(t,e,n,i){var r,o,s,a,c;return r=t.charAt(e),(o=this.fns[r])&&("("!==t.charAt(e+1)?o.call(n,i):(s=t.indexOf(")",e),a=t.substring(e+2,s),c=a.split(","),c.push(i),o.apply(n,c),e=s)),e},t.Turtle=e}(L),function(t){t.turtle.fns={},t.turtle.fns.F=function(e,n){if(n||(n=e,e=this.defaultDistance),n.beginPath(),n.lineWidth=this.lineWidth,n.moveTo(this.position[0],this.position[1]),this.position[0]=this.position[0]+e*this.heading[0],this.position[1]=this.position[1]+e*this.heading[1],this.position[2]=this.position[2]+e*this.heading[2],n.lineTo(this.position[0],this.position[1]),n.stroke(),this.tropism){var i=this.tropismConstant*t.math.absCrossProduct(this.heading,this.tropism),r=t.math.matrixMult([this.heading,this.left,this.up],t.math.rotationMatrixLeft(i));this.heading=r[0],this.left=r[1],this.up=r[2]}},t.turtle.fns.f=function(t,e){e||(e=t,t=this.defaultDistance),this.position[0]=this.position[0]+t*this.heading[0],this.position[1]=this.position[1]+t*this.heading[1],this.position[2]=this.position[2]+t*this.heading[2]},t.turtle.fns["+"]=function(e,n){n||(n=e,e=this.defaultAngle);var i=t.math.matrixMult([this.heading,this.left,this.up],t.math.rotationMatrixUp(t.math.degToRad(e)));this.heading=i[0],this.left=i[1],this.up=i[2]},t.turtle.fns["-"]=function(e,n){n||(n=e,e=this.defaultAngle),t.turtle.fns["+"].call(this,-e,n)},t.turtle.fns["&"]=function(e){var n=t.math.matrixMult([this.heading,this.left,this.up],t.math.rotationMatrixLeft(t.math.degToRad(e)));this.heading=n[0],this.left=n[1],this.up=n[2]},t.turtle.fns["/"]=function(e){var n=t.math.matrixMult([this.heading,this.left,this.up],t.math.rotationMatrixHeading(t.math.degToRad(e)));this.heading=n[0],this.left=n[1],this.up=n[2]},t.turtle.fns["!"]=function(t){this.lineWidth=t},t.turtle.fns["["]=function(){this.pushState()},t.turtle.fns["]"]=function(){this.popState()}}(L),function(t){function e(t,e){this.initialState=t,this.fns=e}e.prototype=new t.Turtle,e.prototype.render=function(t,e,n){var i=this._buildTree(t);i.state=this.initialState.duplicate(),this._renderTree(i,e,n)},e.prototype._buildTree=function(t){var e,n,i;i={children:[],instructions:""};for(var r=0;t.length>r;r++)if(e=t.charAt(r),"["===e)n=this._buildTree(t.substr(r+1)),i.instructions+="#"+(i.children.push(n)-1),r+=n.endIndex+1;else{if("]"===e)break;i.instructions+=e}return i.endIndex=r,i},e.prototype._renderTree=function(t,e){var n,i,r,o,s,a,c,l="";a=t.instructions,c=t.state;for(var u=0;a.length>u;u++)if(n=a.charAt(u),i=this.fns[n])if(1===i.length)i.call(c,e);else{if(r=a.indexOf(")",u),o=a.substring(u+2,r),s=o.split(","),s.push(e),s.length!=i.length)throw Error("Could not extract the correct number of parameters for "+n);l+=i.apply(c,s),u=r}else"#"===n&&(t.children[+a.charAt(++u)].state=c.duplicate());for(u=0;t.children.length>u;u++)setTimeout(this._renderTree.bind(this,t.children[u],e),50)},t.Turtle.Organic=e}(L),function(t){function e(t,e){this.initialState=t,this.fns=e}e.prototype=new t.Turtle,e.prototype.render=function(t,e,n){this._renderRecurse(t,this.initialState.duplicate(),e,n)},e.prototype._renderRecurse=function(t,e,n,i){var r;t.length>0?(r=this.step(t,0,e,n),setTimeout(this._renderRecurse.bind(this,t.substring(0===r?1:r),e,n,i),0)):i&&i()},t.Turtle.Recursive=e}(L),function(t){function e(t,e){this.initialState=t,this.fns=e}e.prototype=new t.Turtle,e.prototype.render=function(t,e,n){for(var i=this.initialState.duplicate(),r=0;t.length>r;r++)r=this.step(t,r,i,e);n&&n()},t.Turtle.Simple=e}(L),function(t){function e(t){this.stack=[],this.fromObject(t)}e.prototype.withLineWidth=function(t){return this.lineWidth=t,this},e.prototype.withDefaultDistance=function(t){return this.defaultDistance=t,this},e.prototype.withPosition=function(t,e,n){return this.position=[t,e,n],this},e.prototype.withTropismVector=function(t,e,n){return this.tropism=[t,e,n],this},e.prototype.withTropismConstant=function(t){return this.tropismConstant=t,this},e.prototype.pushState=function(){this.stack.push(this.toObject())},e.prototype.popState=function(){this.fromObject(this.stack.pop())},e.prototype.duplicate=function(){return new e(this.toObject())},e.prototype.fromObject=function(t){this.lineWidth=t&&t.lineWidth||1,this.defaultDistance=t&&t.defaultDistance||10,this.defaultAngle=t&&t.defaultAngle||90,this.position=t&&t.position||[0,0,0],this.heading=t&&t.heading||[0,-1,0],this.left=t&&t.left||[-1,0,0],this.up=t&&t.up||[0,0,-1],this.tropism=t&&t.tropism,this.tropismConstant=t&&t.tropismConstant||1},e.prototype.toObject=function(){return{lineWidth:this.lineWidth,defaultDistance:this.defaultDistance,defaultAngle:this.defaultAngle,position:[this.position[0],this.position[1],this.position[2]],heading:[this.heading[0],this.heading[1],this.heading[2]],left:[this.left[0],this.left[1],this.left[2]],up:[this.up[0],this.up[1],this.up[2]],tropism:this.tropism&&[this.tropism[0],this.tropism[1],this.tropism[2]],tropismConstant:this.tropismConstant}},t.Turtle.State=e}(L),function(t){function e(t,e,n){"object"==typeof t?(this.axiom=t.axiom,this.constants=t.constants,this.rules=t.rules):(this.axiom=t,this.constants=e,this.rules=n)}e.prototype.iterate=function(t,e,n){var i,r,o,s,a,c,l="";if(n=n||this.axiom,0===t)return e(n),void 0;for(var u=0;n.length>u;u++)if(i=n.charAt(u),r=this.rules[i]){if(c=typeof r,"string"===c)l+=r;else if("function"===c)if(0===r.length)l+=r.call(this.constants);else{if(o=n.indexOf(")",u),s=n.substring(u+2,o),a=s.split(","),a.length!=r.length)throw Error("Could not extract the correct number of parameters for "+i);l+=r.apply(this.constants,a),u=o}}else l+=i;setTimeout(this.iterate.bind(this,t-1,e,l),0)},t.System=e}(L),function(t){t.examples={tree:{system:new t.System({axiom:"!(1)F(130)/(45)A",constants:{d1:94.74,d2:132.63,a:18.95,lr:1.009,vr:1.532},rules:{A:function(){return"!("+this.vr+")F(30)[&("+this.a+")F(30)A]/("+this.d1+")"+"[&("+this.a+")F(30)A]/("+this.d2+")[&("+this.a+")F(30)A]"},F:function(t){return"F("+t*this.lr+")"},"!":function(t){return"!("+t*this.vr+")"}}}),state:(new t.Turtle.State).withLineWidth(1.732).withTropismVector(0,-1,0).withTropismConstant(.25)},quadratic_snowflake:{system:new t.System({axiom:"-F",rules:{F:"F+F-F-F+F"}}),state:(new t.Turtle.State).withDefaultDistance(5)}}}(L);var Subscribable=function(){"use strict";function t(){}return t.prepareInstance=function(e){e.__events={},e.__handlers=[],e.on=t.on,e.un=t.un,e.fire=t.fire,e.hasListener=t.hasListener},t.prototype.__events=null,t.prototype.__handlers=null,t.prototype.on=function(){return t.prepareInstance(this),this.on.apply(this,arguments)},t.prototype.un=function(){return this},t.prototype.fire=function(){return!0},t.prototype.hasListener=function(){return!1},t.fire=function(e){var n,i,r,o,s,a;if("object"==typeof e&&(o=[e],e=""+e.constructor),a=t._getHandlersList(this,e,!1),a&&a.length){for(o=o||Array.prototype.slice.call(arguments,1),n=0,i=a.length;i>n&&r!==!1;n++)(s=this.__handlers[a[n]])&&(r=s[0].apply(s[1],o));return r!==!1}return!0},t._getHandlersList=function(t,e,n){return e=(""+e).toLowerCase(),!t.__events[e]&&n&&(t.__events[e]=[]),t.__events[e]},t._saveHandler=function(t,e,n,i){var r=t.__handlers.length;return t.__handlers.push([e,n,r]),i.push(r),r},t.on=function(e,n,i){return t._saveHandler(this,n,i,t._getHandlersList(this,e,!0))},t.un=function(e,n){var i=typeof e;switch(i){case"number":t.removeSingleEvent(this,e,n);break;case"string":case"function":e=(""+e).toLowerCase(),t.removeMultipleEvents(this,t._getHandlersList(this,e,!1),n),n&&t.consolidateEvents(this,e);break;default:e?(t.removeMultipleHandlers(this,this.__handlers,e||null),t.consolidateEvents(this)):(this.__handlers=[],this.__events={})}},t.consolidateEvents=function(e,n){if(!arguments.length)for(var n in e.__events)t.consolidateEvents(n);var i=e.__events[n];if(i&&i.length)for(var r=i.length-1;r>=0;r--)e.__handlers[i[r]]||i.splice(r,1);i&&!i.length&&delete e.__events[n]},t.removeMultipleEvents=function(e,n,i){for(var r=0,o=n.length;o>r;r++)t.removeSingleEvent(e,n[r],i)},t.removeMultipleHandlers=function(e,n,i){for(var r,o=0,s=n.length;s>o;o++)(r=n[o])&&t.removeSingleEvent(e,r[2],i)},t.removeSingleEvent=function(t,e,n){t.__handlers[e]&&(n&&t.__handlers[e][1]!==n||(t.__handlers[e]=null))},t.hasListener=function(t){var e,n,i,r;if(void 0===t){for(e=this.__handlers,i=0,r=e.length;r>i;i++)if(e[i])return!0}else if(n=this.__events[(""+t).toLowerCase()])for(var i=0,r=n.length;r>i;i++)if(this.__handlers[n[i]])return!0;return!1},t}();"undefined"!=typeof module&&(module.exports=Subscribable),function(){function t(e,n){this.panels=[].slice.call(e.querySelectorAll("div")).map(function(t){return{element:t}}),this._element=e,this._pinned=!1,this._open=!1,this._pinLink=null,this._buildDom(),this.changeAlignment(n||t.ALIGN.RIGHT)}t.prototype.openPanel=function(t){var e=t.element.classList.contains("hidden")||t.link.classList.contains("selected")&&this._pinned;this.hide(),e?(this._element.classList.add("open"),t.element.classList.remove("hidden"),t.link.classList.add("selected"),this._open=!0):t.element.classList.add("hidden")},t.prototype.changeAlignment=function(e){var n=this._element;Object.keys(t.ALIGN).map(function(e){return t.ALIGN[e]}).forEach(function(t){document.body.classList.remove("tweaker-"+t),n.classList.remove(t)}),document.body.classList.add("tweaker-"+e),n.classList.add(e)},t.prototype.show=function(){this.openPanel(this.panels[0])},t.prototype.hide=function(){for(var t=0;this.panels.length>t;t++)this.panels[t].element.classList.add("hidden"),this.panels[t].link.classList.remove("selected");this._pinned||(this._element.classList.remove("open"),this._open=!1)},t.prototype._buildDom=function(){var t,e=document.createElement("ul"),n=document.createElement("ul");this._element.classList.add("tweaker"),e.classList.add("panels"),n.classList.add("tools"),this._pinLink=this._addLinkTo(n,"Pin",this._pinClicked.bind(this));for(var i=0;this.panels.length>i;i++)t=this.panels[i],t.element.classList.add("panel"),t.element.classList.add("hidden"),t.link=this._addLinkTo(e,t.element.getAttribute("data-title"),this._linkClicked.bind(this,t));document.documentElement.addEventListener("mousedown",this._bodyClicked.bind(this)),this._element.appendChild(e),this._element.appendChild(n)},t.prototype._addLinkTo=function(t,e,n){var i=document.createElement("li"),r=document.createElement("a");return r.href="#",r.innerText=e,r.addEventListener("click",n),i.appendChild(r),t.appendChild(i),r},t.prototype._pinClicked=function(t){t.preventDefault(),this._pinned?(document.body.classList.remove("tweaker-pinned"),this._pinLink.classList.remove("selected")):(document.body.classList.add("tweaker-pinned"),this._pinLink.classList.add("selected"),this._open||this.show()),this._pinned=!this._pinned},t.prototype._bodyClicked=function(t){var e=t.target,n=!1;do if(e===this._element){n=!0;break}while(e=e.parentNode);n||this._pinned||this.hide()},t.prototype._linkClicked=function(t,e){e.preventDefault(),this.openPanel(t)},t.ALIGN={RIGHT:"right",BOTTOM:"bottom",LEFT:"left",TOP:"top"},window.Tweaker=t}(),function(){function t(e){this._element=e,this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"),this._contextProxy=new t.ContextProxy(this._context),e.appendChild(this._canvas),this.reflow(),window.addEventListener("resize",this.reflow.bind(this))}t.prototype.reflow=function(){this.width=this._canvas.width=this._element.clientWidth,this.height=this._canvas.height=this._element.clientHeight,this._contextProxy.replay()},t.prototype.clear=function(){this._context.clearRect(0,0,this._canvas.width,this._canvas.height)},t.prototype.getContext=function(){return this._contextProxy},window.DrawingBoard=t}(),function(){function t(t){this._context=t,this._recording=!1;for(var i in this._context)"function"==typeof this._context[i]?this[i]=this._functionProxy.bind(this,i,n[i]||e.UNKNOWN):Object.defineProperty(this,i,{enumerable:!0,get:this._getProxy.bind(this,i),set:this._setProxy.bind(this,i)})}var e={POINT:"point",UNKNOWN:"unknown"},n={moveTo:e.POINT,lineTo:e.POINT};t.prototype.startRecording=function(){this._recording=!0,this._actions=[]},t.prototype.stopRecording=function(){this._recording=!1},t.prototype.replay=function(){var t;if(this._actions&&!this._recording)for(var e=0;this._actions.length>e;e++)switch(t=this._actions[e],t.action){case"call":this._functionCall[t.type].apply(this,[t.key].concat(t.args));break;case"set":this._context[t.key]=t.value}},t.prototype._functionProxy=function(t,e){var n=[].slice.call(arguments,2);this._recording&&this._actions.push({action:"call",type:e,key:t,args:n}),this._functionCall[e].apply(this,[t].concat(n))},t.prototype._getProxy=function(t){return this._context[t]},t.prototype._setProxy=function(t,e){this._recording&&this._actions.push({action:"set",key:t,value:e}),this._context[t]=e},t.prototype._functionCall={},t.prototype._functionCall[e.POINT]=function(t,e,n){this._context[t].call(this._context,e,n)},t.prototype._functionCall[e.UNKNOWN]=function(t){this._context[t].apply(this._context,[].slice.call(arguments,1))},window.DrawingBoard.ContextProxy=t}(),function(){function t(t){t.appendChild(blueprints("lsystem-settings"))}window.LSystemSettings=t}(),function(doc){function blueprints(t,e){return blueprints._s[t](e,blueprints)}var ce="createElement",ct="createTextNode",ac="appendChild",sa="setAttribute",cf="createDocumentFragment";blueprints._s={},blueprints._s["lsystem-settings"]=function(data){var fragment=doc[cf]();with(data||{}){var elem0=doc[ce]("h1");fragment[ac](elem0),elem0[ac](doc[ct]("Lsystem settings"))}return fragment},blueprints._s.structure=function(data){var fragment=doc[cf]();with(data||{}){var elem1=doc[ce]("div");elem1[sa]("class","canvas-container"),fragment[ac](elem1);var elem3=doc[ce]("div");elem3[sa]("class","settings"),fragment[ac](elem3);var elem5=doc[ce]("div");elem5[sa]("class","lsystem-settings"),elem5[sa]("data-title","L-System"),elem3[ac](elem5);var elem7=doc[ce]("div");elem7[sa]("class","turtle-settings"),elem7[sa]("data-title","Turtle"),elem3[ac](elem7)}return fragment},blueprints._s["turtle-settings"]=function(data){var fragment=doc[cf]();with(data||{}){var elem0=doc[ce]("label");elem0[sa]("for","turtleType"),fragment[ac](elem0),elem0[ac](doc[ct]("Pick the type of turtle to use when rendering: "));var elem3=doc[ce]("select");elem3[sa]("id","turtleType"),fragment[ac](elem3),turtles.forEach(function(t){var e=doc[ce]("option"),n="";n+="",n+=t,n+="",e[sa]("value",n),elem3[ac](e),e[ac](doc[ct](t))})}return fragment},window.blueprints=blueprints}(document),function(){function t(e){e.appendChild(blueprints("turtle-settings",{turtles:Object.keys(t.TURTLES)})),this.turtleTypeElement=e.querySelector("#turtleType"),this.turtleTypeElement.addEventListener("change",this._changeTurtle.bind(this))}t.prototype=Object.create(Subscribable.prototype),t.prototype._changeTurtle=function(){var e=this.turtleTypeElement.children[this.turtleTypeElement.selectedIndex].value;this.fire("typeChanged",t.TURTLES[e])},t.TURTLES={Simple:L.Turtle.Simple,Recursive:L.Turtle.Recursive,Organic:L.Turtle.Organic},window.TurtleSettings=t}(),function(){function t(t){n.clear(),L.examples.tree.system.iterate(7,function(e){new t(L.examples.tree.state.withPosition(n.width/2,n.height,0),L.turtle.fns).render(e,i,function(){console.log("rendering done")})})}document.body.appendChild(blueprints("structure"));var e=(new Tweaker(document.querySelector(".settings")),new LSystemSettings(document.querySelector(".lsystem-settings")),new TurtleSettings(document.querySelector(".turtle-settings"))),n=new DrawingBoard(document.querySelector(".canvas-container")),i=n.getContext();t(L.Turtle.Simple),e.on("typeChanged",t)}();