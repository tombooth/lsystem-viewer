/*! lsystem-viewer 06-05-2013 */
(function(){function e(e){if(this._element=e,e.className!=this.classCache){this._classCache=e.className;var t,n=this._classCache.split(" ");for(t=0;n.length>t;t++)o.call(this,n[t])}}function t(e,t){e.className=t.join(" ")}function n(e,t,n){Object.defineProperty?Object.defineProperty(e,t,{get:n}):e.__defineGetter__(t,n)}if(!("undefined"==typeof Element||"classList"in document.documentElement)){var i=[].indexOf,r=[].slice,o=[].push,s=[].splice,a=[].join;e.prototype={add:function(e){o.call(this,e),t(this._element,r.call(this,0))},contains:function(e){return-1!==i.call(this,e)},item:function(e){return this[e]||null},remove:function(e){var n=i.call(this,e);-1!==n&&(s.call(this,n,1),t(this._element,r.call(this,0)))},toString:function(){return a.call(this," ")},toggle:function(e){-1===i.call(this,e)?this.add(e):this.remove(e)}},window.DOMTokenList=e,n(Element.prototype,"classList",function(){return new e(this)})}})(),function(e){"function"==typeof define?define(e):"function"==typeof YUI?YUI.add("es5-sham",e):e()}(function(){function e(e){try{return Object.defineProperty(e,"sentinel",{}),"sentinel"in e}catch(t){}}var t,n,i,r,o,s=Function.prototype.call,a=Object.prototype,l=s.bind(a.hasOwnProperty);if((o=l(a,"__defineGetter__"))&&(t=s.bind(a.__defineGetter__),n=s.bind(a.__defineSetter__),i=s.bind(a.__lookupGetter__),r=s.bind(a.__lookupSetter__)),Object.getPrototypeOf||(Object.getPrototypeOf=function(e){return e.__proto__||(e.constructor?e.constructor.prototype:a)}),!Object.getOwnPropertyDescriptor){var c="Object.getOwnPropertyDescriptor called on a non-object: ";Object.getOwnPropertyDescriptor=function(e,t){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError(c+e);if(l(e,t)){var n={enumerable:!0,configurable:!0};if(o){var s=e.__proto__;e.__proto__=a;var u=i(e,t),h=r(e,t);if(e.__proto__=s,u||h)return u&&(n.get=u),h&&(n.set=h),n}return n.value=e[t],n}}}if(Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(e){return Object.keys(e)}),!Object.create){var u,h=null===Object.prototype.__proto__;u=h||"undefined"==typeof document?function(){return{__proto__:null}}:function(){function e(){}var t=document.createElement("iframe"),n=document.body||document.documentElement;t.style.display="none",n.appendChild(t),t.src="javascript:";var i=t.contentWindow.Object.prototype;return n.removeChild(t),t=null,delete i.constructor,delete i.hasOwnProperty,delete i.propertyIsEnumerable,delete i.isPrototypeOf,delete i.toLocaleString,delete i.toString,delete i.valueOf,i.__proto__=null,e.prototype=i,function(){return new e}}(),Object.create=function(e,t){function n(){}var i;if(null===e)i=u();else{if("object"!=typeof e&&"function"!=typeof e)throw new TypeError("Object prototype may only be an Object or null");n.prototype=e,i=new n,i.__proto__=e}return void 0!==t&&Object.defineProperties(i,t),i}}if(Object.defineProperty){var p=e({}),m="undefined"==typeof document||e(document.createElement("div"));if(!p||!m)var f=Object.defineProperty,d=Object.defineProperties}if(!Object.defineProperty||f){var y="Property description must be an object: ",_="Object.defineProperty called on non-object: ",v="getters & setters can not be defined on this javascript engine";Object.defineProperty=function(e,s,c){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError(_+e);if("object"!=typeof c&&"function"!=typeof c||null===c)throw new TypeError(y+c);if(f)try{return f.call(Object,e,s,c)}catch(u){}if(l(c,"value"))if(o&&(i(e,s)||r(e,s))){var h=e.__proto__;e.__proto__=a,delete e[s],e[s]=c.value,e.__proto__=h}else e[s]=c.value;else{if(!o)throw new TypeError(v);l(c,"get")&&t(e,s,c.get),l(c,"set")&&n(e,s,c.set)}return e}}(!Object.defineProperties||d)&&(Object.defineProperties=function(e,t){if(d)try{return d.call(Object,e,t)}catch(n){}for(var i in t)l(t,i)&&"__proto__"!=i&&Object.defineProperty(e,i,t[i]);return e}),Object.seal||(Object.seal=function(e){return e}),Object.freeze||(Object.freeze=function(e){return e});try{Object.freeze(function(){})}catch(g){Object.freeze=function(e){return function(t){return"function"==typeof t?t:e(t)}}(Object.freeze)}Object.preventExtensions||(Object.preventExtensions=function(e){return e}),Object.isSealed||(Object.isSealed=function(){return!1}),Object.isFrozen||(Object.isFrozen=function(){return!1}),Object.isExtensible||(Object.isExtensible=function(e){if(Object(e)!==e)throw new TypeError;for(var t="";l(e,t);)t+="?";e[t]=!0;var n=l(e,t);return delete e[t],n})}),function(e){"function"==typeof define?define(e):"function"==typeof YUI?YUI.add("es5",e):e()}(function(){function e(){}function t(e){return e=+e,e!==e?e=0:0!==e&&e!==1/0&&e!==-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e}function n(e){var t=typeof e;return null===e||"undefined"===t||"boolean"===t||"number"===t||"string"===t}function i(e){var t,i,r;if(n(e))return e;if(i=e.valueOf,"function"==typeof i&&(t=i.call(e),n(t)))return t;if(r=e.toString,"function"==typeof r&&(t=r.call(e),n(t)))return t;throw new TypeError}Function.prototype.bind||(Function.prototype.bind=function(t){var n=this;if("function"!=typeof n)throw new TypeError("Function.prototype.bind called on incompatible "+n);var i=p.call(arguments,1),r=function(){if(this instanceof r){var e=n.apply(this,i.concat(p.call(arguments)));return Object(e)===e?e:this}return n.apply(t,i.concat(p.call(arguments)))};return n.prototype&&(e.prototype=n.prototype,r.prototype=new e,e.prototype=null),r});var r,o,s,a,l,c=Function.prototype.call,u=Array.prototype,h=Object.prototype,p=u.slice,m=c.bind(h.toString),f=c.bind(h.hasOwnProperty);if((l=f(h,"__defineGetter__"))&&(r=c.bind(h.__defineGetter__),o=c.bind(h.__defineSetter__),s=c.bind(h.__lookupGetter__),a=c.bind(h.__lookupSetter__)),2!=[1,2].splice(0).length){var d=Array.prototype.splice;Array.prototype.splice=function(e,t){return arguments.length?d.apply(this,[void 0===e?0:e,void 0===t?this.length-e:t].concat(p.call(arguments,2))):[]}}if(1!=[].unshift(0)){var y=Array.prototype.unshift;Array.prototype.unshift=function(){return y.apply(this,arguments),this.length}}Array.isArray||(Array.isArray=function(e){return"[object Array]"==m(e)});var _=Object("a"),v="a"!=_[0]||!(0 in _);if(Array.prototype.forEach||(Array.prototype.forEach=function(e){var t=C(this),n=v&&"[object String]"==m(this)?this.split(""):t,i=arguments[1],r=-1,o=n.length>>>0;if("[object Function]"!=m(e))throw new TypeError;for(;o>++r;)r in n&&e.call(i,n[r],r,t)}),Array.prototype.map||(Array.prototype.map=function(e){var t=C(this),n=v&&"[object String]"==m(this)?this.split(""):t,i=n.length>>>0,r=Array(i),o=arguments[1];if("[object Function]"!=m(e))throw new TypeError(e+" is not a function");for(var s=0;i>s;s++)s in n&&(r[s]=e.call(o,n[s],s,t));return r}),Array.prototype.filter||(Array.prototype.filter=function(e){var t,n=C(this),i=v&&"[object String]"==m(this)?this.split(""):n,r=i.length>>>0,o=[],s=arguments[1];if("[object Function]"!=m(e))throw new TypeError(e+" is not a function");for(var a=0;r>a;a++)a in i&&(t=i[a],e.call(s,t,a,n)&&o.push(t));return o}),Array.prototype.every||(Array.prototype.every=function(e){var t=C(this),n=v&&"[object String]"==m(this)?this.split(""):t,i=n.length>>>0,r=arguments[1];if("[object Function]"!=m(e))throw new TypeError(e+" is not a function");for(var o=0;i>o;o++)if(o in n&&!e.call(r,n[o],o,t))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(e){var t=C(this),n=v&&"[object String]"==m(this)?this.split(""):t,i=n.length>>>0,r=arguments[1];if("[object Function]"!=m(e))throw new TypeError(e+" is not a function");for(var o=0;i>o;o++)if(o in n&&e.call(r,n[o],o,t))return!0;return!1}),Array.prototype.reduce||(Array.prototype.reduce=function(e){var t=C(this),n=v&&"[object String]"==m(this)?this.split(""):t,i=n.length>>>0;if("[object Function]"!=m(e))throw new TypeError(e+" is not a function");if(!i&&1==arguments.length)throw new TypeError("reduce of empty array with no initial value");var r,o=0;if(arguments.length>=2)r=arguments[1];else for(;;){if(o in n){r=n[o++];break}if(++o>=i)throw new TypeError("reduce of empty array with no initial value")}for(;i>o;o++)o in n&&(r=e.call(void 0,r,n[o],o,t));return r}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(e){var t=C(this),n=v&&"[object String]"==m(this)?this.split(""):t,i=n.length>>>0;if("[object Function]"!=m(e))throw new TypeError(e+" is not a function");if(!i&&1==arguments.length)throw new TypeError("reduceRight of empty array with no initial value");var r,o=i-1;if(arguments.length>=2)r=arguments[1];else for(;;){if(o in n){r=n[o--];break}if(0>--o)throw new TypeError("reduceRight of empty array with no initial value")}do o in this&&(r=e.call(void 0,r,n[o],o,t));while(o--);return r}),Array.prototype.indexOf&&-1==[0,1].indexOf(1,2)||(Array.prototype.indexOf=function(e){var n=v&&"[object String]"==m(this)?this.split(""):C(this),i=n.length>>>0;if(!i)return-1;var r=0;for(arguments.length>1&&(r=t(arguments[1])),r=r>=0?r:Math.max(0,i+r);i>r;r++)if(r in n&&n[r]===e)return r;return-1}),Array.prototype.lastIndexOf&&-1==[0,1].lastIndexOf(0,-3)||(Array.prototype.lastIndexOf=function(e){var n=v&&"[object String]"==m(this)?this.split(""):C(this),i=n.length>>>0;if(!i)return-1;var r=i-1;for(arguments.length>1&&(r=Math.min(r,t(arguments[1]))),r=r>=0?r:i-Math.abs(r);r>=0;r--)if(r in n&&e===n[r])return r;return-1}),!Object.keys){var g=!0,b=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],w=b.length;for(var O in{toString:null})g=!1;Object.keys=function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on a non-object");var t=[];for(var n in e)f(e,n)&&t.push(n);if(g)for(var i=0,r=w;r>i;i++){var o=b[i];f(e,o)&&t.push(o)}return t}}var T=-621987552e5,S="-000001";Date.prototype.toISOString&&-1!==new Date(T).toISOString().indexOf(S)||(Date.prototype.toISOString=function(){var e,t,n,i,r;if(!isFinite(this))throw new RangeError("Date.prototype.toISOString called on non-finite value.");for(i=this.getUTCFullYear(),r=this.getUTCMonth(),i+=Math.floor(r/12),r=(r%12+12)%12,e=[r+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()],i=(0>i?"-":i>9999?"+":"")+("00000"+Math.abs(i)).slice(i>=0&&9999>=i?-4:-6),t=e.length;t--;)n=e[t],10>n&&(e[t]="0"+n);return i+"-"+e.slice(0,2).join("-")+"T"+e.slice(2).join(":")+"."+("000"+this.getUTCMilliseconds()).slice(-3)+"Z"});var x=!1;try{x=Date.prototype.toJSON&&null===new Date(0/0).toJSON()&&-1!==new Date(T).toJSON().indexOf(S)&&Date.prototype.toJSON.call({toISOString:function(){return!0}})}catch(j){}if(x||(Date.prototype.toJSON=function(){var e,t=Object(this),n=i(t);if("number"==typeof n&&!isFinite(n))return null;if(e=t.toISOString,"function"!=typeof e)throw new TypeError("toISOString property is not callable");return e.call(t)}),Date=function(e){function t(n,i,r,o,s,a,l){var c=arguments.length;if(this instanceof e){var u=1==c&&n+""===n?new e(t.parse(n)):c>=7?new e(n,i,r,o,s,a,l):c>=6?new e(n,i,r,o,s,a):c>=5?new e(n,i,r,o,s):c>=4?new e(n,i,r,o):c>=3?new e(n,i,r):c>=2?new e(n,i):c>=1?new e(n):new e;return u.constructor=t,u}return e.apply(this,arguments)}function n(e,t){var n=t>1?1:0;return r[t]+Math.floor((e-1969+n)/4)-Math.floor((e-1901+n)/100)+Math.floor((e-1601+n)/400)+365*(e-1970)}var i=RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:\\.(\\d{3}))?)?(Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$"),r=[0,31,59,90,120,151,181,212,243,273,304,334,365];for(var o in e)t[o]=e[o];return t.now=e.now,t.UTC=e.UTC,t.prototype=e.prototype,t.prototype.constructor=t,t.parse=function(t){var r=i.exec(t);if(r){var o,s=Number(r[1]),a=Number(r[2]||1)-1,l=Number(r[3]||1)-1,c=Number(r[4]||0),u=Number(r[5]||0),h=Number(r[6]||0),p=Number(r[7]||0),m=!r[4]||r[8]?0:Number(new e(1970,0)),f="-"===r[9]?1:-1,d=Number(r[10]||0),y=Number(r[11]||0);return(u>0||h>0||p>0?24:25)>c&&60>u&&60>h&&1e3>p&&a>-1&&12>a&&24>d&&60>y&&l>-1&&n(s,a+1)-n(s,a)>l&&(o=60*(24*(n(s,a)+l)+c+d*f),o=1e3*(60*(o+u+y*f)+h)+p+m,o>=-864e13&&864e13>=o)?o:0/0}return e.parse.apply(this,arguments)},t}(Date),Date.now||(Date.now=function(){return(new Date).getTime()}),"0".split(void 0,0).length){var E=String.prototype.split;String.prototype.split=function(e,t){return void 0===e&&0===t?[]:E.apply(this,arguments)}}if("".substr&&"b"!=="0b".substr(-1)){var L=String.prototype.substr;String.prototype.substr=function(e,t){return L.call(this,0>e?0>(e=this.length+e)?0:e:e,t)}}var k="	\n\f\r   ᠎             　\u2028\u2029﻿";if(!String.prototype.trim||k.trim()){k="["+k+"]";var D=RegExp("^"+k+k+"*"),A=RegExp(k+k+"*$");String.prototype.trim=function(){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");return(this+"").replace(D,"").replace(A,"")}}var C=function(e){if(null==e)throw new TypeError("can't convert "+e+" to object");return Object(e)}}),function(){window.L={turtle:{}}}(),function(e){function t(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}function n(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}e.math={},e.math.degToRad=function(e){return e*(Math.PI/180)},e.math.rotationMatrixUp=function(e){return[[Math.cos(e),-Math.sin(e),0],[Math.sin(e),Math.cos(e),0],[0,0,1]]},e.math.rotationMatrixLeft=function(e){return[[Math.cos(e),0,Math.sin(e)],[0,1,0],[-Math.sin(e),0,Math.cos(e)]]},e.math.rotationMatrixHeading=function(e){return[[1,0,0],[0,Math.cos(e),Math.sin(e)],[0,-Math.sin(e),Math.cos(e)]]},e.math.matrixMult=function(e,t){var n=[[0,0,0],[0,0,0],[0,0,0]];return n[0][0]=e[0][0]*t[0][0]+e[1][0]*t[0][1]+e[2][0]*t[0][2],n[0][1]=e[0][1]*t[0][0]+e[1][1]*t[0][1]+e[2][1]*t[0][2],n[0][2]=e[0][2]*t[0][0]+e[1][2]*t[0][1]+e[2][2]*t[0][2],n[1][0]=e[0][0]*t[1][0]+e[1][0]*t[1][1]+e[2][0]*t[1][2],n[1][1]=e[0][1]*t[1][0]+e[1][1]*t[1][1]+e[2][1]*t[1][2],n[1][2]=e[0][2]*t[1][0]+e[1][2]*t[1][1]+e[2][2]*t[1][2],n[2][0]=e[0][0]*t[2][0]+e[1][0]*t[2][1]+e[2][0]*t[2][2],n[2][1]=e[0][1]*t[2][0]+e[1][1]*t[2][1]+e[2][1]*t[2][2],n[2][2]=e[0][2]*t[2][0]+e[1][2]*t[2][1]+e[2][2]*t[2][2],n},e.math.absCrossProduct=function(e,i){var r=t(e),o=t(i),s=Math.acos(n(e,i)/(r*o));return r*o*Math.sin(s)}}(L),function(e){function t(){}t.prototype.step=function(e,t,n,i){var r,o,s,a,l;return r=e.charAt(t),(o=this.fns[r])&&("("!==e.charAt(t+1)?o.call(n,i):(s=e.indexOf(")",t),a=e.substring(t+2,s),l=a.split(","),l.push(i),o.apply(n,l),t=s)),t},e.Turtle=t}(L),function(e){e.turtle.fns={},e.turtle.fns.F=function(t,n){if(n||(n=t,t=this.defaultDistance),n.beginPath(),n.lineWidth=this.lineWidth,n.moveTo(this.position[0],this.position[1]),this.position[0]=this.position[0]+t*this.heading[0],this.position[1]=this.position[1]+t*this.heading[1],this.position[2]=this.position[2]+t*this.heading[2],n.lineTo(this.position[0],this.position[1]),n.stroke(),this.tropismEnabled){var i=this.tropismConstant*e.math.absCrossProduct(this.heading,this.tropism),r=e.math.matrixMult([this.heading,this.left,this.up],e.math.rotationMatrixLeft(i));this.heading=r[0],this.left=r[1],this.up=r[2]}},e.turtle.fns.f=function(e,t){t||(t=e,e=this.defaultDistance),this.position[0]=this.position[0]+e*this.heading[0],this.position[1]=this.position[1]+e*this.heading[1],this.position[2]=this.position[2]+e*this.heading[2]},e.turtle.fns["+"]=function(t,n){n||(n=t,t=this.defaultAngle);var i=e.math.matrixMult([this.heading,this.left,this.up],e.math.rotationMatrixUp(e.math.degToRad(t)));this.heading=i[0],this.left=i[1],this.up=i[2]},e.turtle.fns["-"]=function(t,n){n||(n=t,t=this.defaultAngle),e.turtle.fns["+"].call(this,-t,n)},e.turtle.fns["&"]=function(t){var n=e.math.matrixMult([this.heading,this.left,this.up],e.math.rotationMatrixLeft(e.math.degToRad(t)));this.heading=n[0],this.left=n[1],this.up=n[2]},e.turtle.fns["/"]=function(t){var n=e.math.matrixMult([this.heading,this.left,this.up],e.math.rotationMatrixHeading(e.math.degToRad(t)));this.heading=n[0],this.left=n[1],this.up=n[2]},e.turtle.fns["!"]=function(e){this.lineWidth=e},e.turtle.fns["["]=function(){this.pushState()},e.turtle.fns["]"]=function(){this.popState()}}(L),function(e){function t(e,t){this.initialState=e,this.fns=t}t.prototype=new e.Turtle,t.prototype.render=function(e,t,n){var i=this._buildTree(e);i.state=this.initialState.duplicate(),this._renderTree(i,t,n)},t.prototype._buildTree=function(e){var t,n,i;i={children:[],instructions:""};for(var r=0;e.length>r;r++)if(t=e.charAt(r),"["===t)n=this._buildTree(e.substr(r+1)),i.instructions+="#"+(i.children.push(n)-1),r+=n.endIndex+1;else{if("]"===t)break;i.instructions+=t}return i.endIndex=r,i},t.prototype._renderTree=function(e,t){var n,i,r,o,s,a,l,c="";a=e.instructions,l=e.state;for(var u=0;a.length>u;u++)if(n=a.charAt(u),i=this.fns[n])if(1===i.length)i.call(l,t);else{if(r=a.indexOf(")",u),o=a.substring(u+2,r),s=o.split(","),s.push(t),s.length!=i.length)throw Error("Could not extract the correct number of parameters for "+n);c+=i.apply(l,s),u=r}else"#"===n&&(e.children[+a.charAt(++u)].state=l.duplicate());for(u=0;e.children.length>u;u++)setTimeout(this._renderTree.bind(this,e.children[u],t),50)},e.Turtle.Organic=t}(L),function(e){function t(e,t){this.initialState=e,this.fns=t}t.prototype=new e.Turtle,t.prototype.render=function(e,t,n){this._renderRecurse(e,this.initialState.duplicate(),t,n)},t.prototype._renderRecurse=function(e,t,n,i){var r;e.length>0?(r=this.step(e,0,t,n),setTimeout(this._renderRecurse.bind(this,e.substring(0===r?1:r),t,n,i),0)):i&&i()},e.Turtle.Recursive=t}(L),function(e){function t(e,t){this.initialState=e,this.fns=t}t.prototype=new e.Turtle,t.prototype.render=function(e,t,n){for(var i=this.initialState.duplicate(),r=0;e.length>r;r++)r=this.step(e,r,i,t);n&&n()},e.Turtle.Simple=t}(L),function(e){function t(e){this.stack=[],this.fromObject(e)}t.prototype.withLineWidth=function(e){return this.lineWidth=e,this},t.prototype.withDefaultDistance=function(e){return this.defaultDistance=e,this},t.prototype.withPosition=function(e,t,n){return this.position=[e,t,n],this},t.prototype.withTropismEnabled=function(e){return this.tropismEnabled=e,this},t.prototype.withTropismVector=function(e,t,n){return this.tropism=[e,t,n],this},t.prototype.withTropismConstant=function(e){return this.tropismConstant=e,this},t.prototype.pushState=function(){this.stack.push(this.toObject())},t.prototype.popState=function(){this.fromObject(this.stack.pop())},t.prototype.duplicate=function(){return new t(this.toObject())},t.prototype.fromObject=function(e){this.lineWidth=e&&e.lineWidth||1,this.defaultDistance=e&&e.defaultDistance||10,this.defaultAngle=e&&e.defaultAngle||90,this.position=e&&e.position||[0,0,0],this.heading=e&&e.heading||[0,-1,0],this.left=e&&e.left||[-1,0,0],this.up=e&&e.up||[0,0,-1],this.tropismEnabled=e&&void 0!==e.tropismEnabled?!!e.tropismEnabled:!1,this.tropism=e&&e.tropism||[0,0,0],this.tropismConstant=e&&e.tropismConstant||1},t.prototype.toObject=function(){return{lineWidth:this.lineWidth,defaultDistance:this.defaultDistance,defaultAngle:this.defaultAngle,position:[this.position[0],this.position[1],this.position[2]],heading:[this.heading[0],this.heading[1],this.heading[2]],left:[this.left[0],this.left[1],this.left[2]],up:[this.up[0],this.up[1],this.up[2]],tropismEnabled:this.tropismEnabled,tropism:this.tropism&&[this.tropism[0],this.tropism[1],this.tropism[2]],tropismConstant:this.tropismConstant}},e.Turtle.State=t}(L),function(e){function t(e,t,n){"object"==typeof e?(this.axiom=e.axiom,this.constants=e.constants,this.rules=e.rules):(this.axiom=e,this.constants=t,this.rules=n)}t.prototype.iterate=function(e,t,n){var i,r,o,s,a,l,c="";if(n=n||this.axiom,0===e)return t(n),void 0;for(var u=0;n.length>u;u++)if(i=n.charAt(u),r=this.rules[i]){if(l=typeof r,"string"===l)c+=r;else if("function"===l)if(0===r.length)c+=r.call(this.constants);else{if(o=n.indexOf(")",u),s=n.substring(u+2,o),a=s.split(","),a.length!=r.length)throw Error("Could not extract the correct number of parameters for "+i);c+=r.apply(this.constants,a),u=o}}else c+=i;setTimeout(this.iterate.bind(this,e-1,t,c),0)},e.System=t}(L),function(e){e.examples={tree:{name:"Tree",system:new e.System({axiom:"!(1)F(130)/(45)A",constants:{d1:94.74,d2:132.63,a:18.95,lr:1.009,vr:1.532},rules:{A:function(){return"!("+this.vr+")F(30)[&("+this.a+")F(30)A]/("+this.d1+")"+"[&("+this.a+")F(30)A]/("+this.d2+")[&("+this.a+")F(30)A]"},F:function(e){return"F("+e*this.lr+")"},"!":function(e){return"!("+e*this.vr+")"}}}),state:(new e.Turtle.State).withLineWidth(1.732).withTropismEnabled(!0).withTropismVector(0,-1,0).withTropismConstant(.25),iterations:7},quadratic_snowflake:{name:"Quadratic Snowflake",system:new e.System({axiom:"-F",rules:{F:"F+F-F-F+F"}}),state:(new e.Turtle.State).withDefaultDistance(5),iterations:4}}}(L);var Subscribable=function(){"use strict";function e(){}return e.prepareInstance=function(t){t.__events={},t.__handlers=[],t.on=e.on,t.un=e.un,t.fire=e.fire,t.hasListener=e.hasListener},e.prototype.__events=null,e.prototype.__handlers=null,e.prototype.on=function(){return e.prepareInstance(this),this.on.apply(this,arguments)},e.prototype.un=function(){return this},e.prototype.fire=function(){return!0},e.prototype.hasListener=function(){return!1},e.fire=function(t){var n,i,r,o,s,a;if("object"==typeof t&&(o=[t],t=""+t.constructor),a=e._getHandlersList(this,t,!1),a&&a.length){for(o=o||Array.prototype.slice.call(arguments,1),n=0,i=a.length;i>n&&r!==!1;n++)(s=this.__handlers[a[n]])&&(r=s[0].apply(s[1],o));return r!==!1}return!0},e._getHandlersList=function(e,t,n){return t=(""+t).toLowerCase(),!e.__events[t]&&n&&(e.__events[t]=[]),e.__events[t]},e._saveHandler=function(e,t,n,i){var r=e.__handlers.length;return e.__handlers.push([t,n,r]),i.push(r),r},e.on=function(t,n,i){return e._saveHandler(this,n,i,e._getHandlersList(this,t,!0))},e.un=function(t,n){var i=typeof t;switch(i){case"number":e.removeSingleEvent(this,t,n);break;case"string":case"function":t=(""+t).toLowerCase(),e.removeMultipleEvents(this,e._getHandlersList(this,t,!1),n),n&&e.consolidateEvents(this,t);break;default:t?(e.removeMultipleHandlers(this,this.__handlers,t||null),e.consolidateEvents(this)):(this.__handlers=[],this.__events={})}},e.consolidateEvents=function(t,n){if(!arguments.length)for(var n in t.__events)e.consolidateEvents(n);var i=t.__events[n];if(i&&i.length)for(var r=i.length-1;r>=0;r--)t.__handlers[i[r]]||i.splice(r,1);i&&!i.length&&delete t.__events[n]},e.removeMultipleEvents=function(t,n,i){for(var r=0,o=n.length;o>r;r++)e.removeSingleEvent(t,n[r],i)},e.removeMultipleHandlers=function(t,n,i){for(var r,o=0,s=n.length;s>o;o++)(r=n[o])&&e.removeSingleEvent(t,r[2],i)},e.removeSingleEvent=function(e,t,n){e.__handlers[t]&&(n&&e.__handlers[t][1]!==n||(e.__handlers[t]=null))},e.hasListener=function(e){var t,n,i,r;if(void 0===e){for(t=this.__handlers,i=0,r=t.length;r>i;i++)if(t[i])return!0}else if(n=this.__events[(""+e).toLowerCase()])for(var i=0,r=n.length;r>i;i++)if(this.__handlers[n[i]])return!0;return!1},e}();"undefined"!=typeof module&&(module.exports=Subscribable),function(){function e(t,n){this.panels=[].slice.call(t.querySelectorAll("div")).map(function(e){return{element:e}}),this._element=t,this._pinned=!1,this._open=!1,this._pinLink=null,this._buildDom(),this.changeAlignment(n||e.ALIGN.RIGHT)}e.prototype.openPanel=function(e){var t=e.element.classList.contains("hidden")||e.link.classList.contains("selected")&&this._pinned;this.hide(),t?(this._element.classList.add("open"),e.element.classList.remove("hidden"),e.link.classList.add("selected"),this._open=!0):e.element.classList.add("hidden")},e.prototype.changeAlignment=function(t){var n=this._element;Object.keys(e.ALIGN).map(function(t){return e.ALIGN[t]}).forEach(function(e){document.body.classList.remove("tweaker-"+e),n.classList.remove(e)}),document.body.classList.add("tweaker-"+t),n.classList.add(t)},e.prototype.show=function(){this.openPanel(this.panels[0])},e.prototype.hide=function(){for(var e=0;this.panels.length>e;e++)this.panels[e].element.classList.add("hidden"),this.panels[e].link.classList.remove("selected");this._pinned||(this._element.classList.remove("open"),this._open=!1)},e.prototype.pin=function(){this._pinned?(document.body.classList.remove("tweaker-pinned"),this._pinLink.classList.remove("selected")):(document.body.classList.add("tweaker-pinned"),this._pinLink.classList.add("selected"),this._open||this.show()),this._pinned=!this._pinned},e.prototype._buildDom=function(){var e,t=document.createElement("ul"),n=document.createElement("ul");this._element.classList.add("tweaker"),t.classList.add("panels"),n.classList.add("tools"),this._pinLink=this._addLinkTo(n,"Pin",this._pinClicked.bind(this));for(var i=0;this.panels.length>i;i++)e=this.panels[i],e.element.classList.add("panel"),e.element.classList.add("hidden"),e.link=this._addLinkTo(t,e.element.getAttribute("data-title"),this._linkClicked.bind(this,e));document.documentElement.addEventListener("mousedown",this._bodyClicked.bind(this)),this._element.appendChild(t),this._element.appendChild(n)},e.prototype._addLinkTo=function(e,t,n){var i=document.createElement("li"),r=document.createElement("a");return i.className="link-item",r.href="#",r.innerText=t,r.addEventListener("click",n),i.appendChild(r),e.appendChild(i),r},e.prototype._pinClicked=function(e){e.preventDefault(),this.pin()},e.prototype._bodyClicked=function(e){var t=e.target,n=!1;do if(t===this._element){n=!0;break}while(t=t.parentNode);n||this._pinned||this.hide()},e.prototype._linkClicked=function(e,t){t.preventDefault(),this.openPanel(e)},e.ALIGN={RIGHT:"right",BOTTOM:"bottom",LEFT:"left",TOP:"top"},window.Tweaker=e}(),function(){function e(t){this._element=t,this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"),this._contextProxy=new e.ContextProxy(this._context),t.appendChild(this._canvas),this.reflow(),window.addEventListener("resize",this.reflow.bind(this))}e.prototype.reflow=function(){this.width=this._canvas.width=this._element.clientWidth,this.height=this._canvas.height=this._element.clientHeight,this._contextProxy.replay()},e.prototype.clear=function(){this._context.clearRect(0,0,this._canvas.width,this._canvas.height)},e.prototype.getContext=function(){return this._contextProxy},window.DrawingBoard=e}(),function(){function e(e){this._context=e,this._recording=!1;for(var i in this._context)"function"==typeof this._context[i]?this[i]=this._functionProxy.bind(this,i,n[i]||t.UNKNOWN):Object.defineProperty(this,i,{enumerable:!0,get:this._getProxy.bind(this,i),set:this._setProxy.bind(this,i)})}var t={POINT:"point",UNKNOWN:"unknown"},n={moveTo:t.POINT,lineTo:t.POINT};e.prototype.startRecording=function(){this._recording=!0,this._actions=[]},e.prototype.stopRecording=function(){this._recording=!1},e.prototype.replay=function(){var e;if(this._actions&&!this._recording)for(var t=0;this._actions.length>t;t++)switch(e=this._actions[t],e.action){case"call":this._functionCall[e.type].apply(this,[e.key].concat(e.args));break;case"set":this._context[e.key]=e.value}},e.prototype._functionProxy=function(e,t){var n=[].slice.call(arguments,2);this._recording&&this._actions.push({action:"call",type:t,key:e,args:n}),this._functionCall[t].apply(this,[e].concat(n))},e.prototype._getProxy=function(e){return this._context[e]},e.prototype._setProxy=function(e,t){this._recording&&this._actions.push({action:"set",key:e,value:t}),this._context[e]=t},e.prototype._functionCall={},e.prototype._functionCall[t.POINT]=function(e,t,n){this._context[e].call(this._context,t,n)},e.prototype._functionCall[t.UNKNOWN]=function(e){this._context[e].apply(this._context,[].slice.call(arguments,1))},window.DrawingBoard.ContextProxy=e}(),function(){function e(e){this._element=e,this._exampleDefinitions=Object.keys(L.examples).map(function(e){return L.examples[e]})}e.prototype=Object.create(Subscribable.prototype),e.prototype.getLSystem=function(){return this._lsystem},e.prototype.getIterations=function(){return this._iterations},e.prototype.setDefinition=function(e){this._definition=e,this._lsystem=e.system,this._iterations=e.iterations,this._render(),this.fire("lsystemChanged",e)},e.prototype._render=function(){var e=this._exampleDefinitions.indexOf(this._definition);this._element.innerHTML="",this._element.appendChild(blueprints("lsystem-settings",{exampleDefinitions:this._exampleDefinitions,currentDefinition:this._definition})),this._lsystemElement=this._element.querySelector("#lsystem"),this._lsystemElement.querySelectorAll("option")[e].selected=!0,this._lsystemElement.addEventListener("change",this._changeDefinition.bind(this))},e.prototype._changeDefinition=function(){var e=this._lsystemElement.children[this._lsystemElement.selectedIndex].value;this.setDefinition(this._exampleDefinitions[e])},window.LSystemSettings=e}(),function(doc){function blueprints(e,t){return blueprints._s[e](t,blueprints)}var ce="createElement",ct="createTextNode",ac="appendChild",sa="setAttribute",cf="createDocumentFragment";blueprints._s={},blueprints._s["edit-vector"]=function(data){var fragment=doc[cf]();with(data||{}){var elem0=doc[ce]("li");elem0[sa]("class","vector"),fragment[ac](elem0);var elem2=doc[ce]("h3");elem0[ac](elem2),elem2[ac](doc[ct](name));var elem5=doc[ce]("label");elem0[ac](elem5),elem5[ac](doc[ct]("i "));var elem7=doc[ce]("input");elem7[sa]("type","text");var elem7_attr1="";elem7_attr1+="",elem7_attr1+=vector[0],elem7_attr1+="",elem7[sa]("value",elem7_attr1),elem5[ac](elem7);var elem9=doc[ce]("label");elem0[ac](elem9),elem9[ac](doc[ct]("j "));var elem11=doc[ce]("input");elem11[sa]("type","text");var elem11_attr1="";elem11_attr1+="",elem11_attr1+=vector[1],elem11_attr1+="",elem11[sa]("value",elem11_attr1),elem9[ac](elem11);var elem13=doc[ce]("label");elem0[ac](elem13),elem13[ac](doc[ct]("k "));var elem15=doc[ce]("input");elem15[sa]("type","text");var elem15_attr1="";elem15_attr1+="",elem15_attr1+=vector[2],elem15_attr1+="",elem15[sa]("value",elem15_attr1),elem13[ac](elem15)}return fragment},blueprints._s["lsystem-settings"]=function(data){var fragment=doc[cf]();with(data||{}){var elem0=doc[ce]("div");elem0[sa]("class","selector"),fragment[ac](elem0);var elem2=doc[ce]("label");elem2[sa]("for","lsystem"),elem0[ac](elem2),elem2[ac](doc[ct]("Pick an L-System to render: "));var elem5=doc[ce]("select");elem5[sa]("id","lsystem"),elem0[ac](elem5),exampleDefinitions.forEach(function(e,t){var n=doc[ce]("option"),i="";i+="",i+=t,i+="",n[sa]("value",i),elem5[ac](n),n[ac](doc[ct](e.name))});var elem12=doc[ce]("div");elem12[sa]("class","definition"),fragment[ac](elem12);var elem14=doc[ce]("h1");elem12[ac](elem14),elem14[ac](doc[ct](currentDefinition.name));var elem17=doc[ce]("h2");elem12[ac](elem17),elem17[ac](doc[ct]("Axiom"));var elem20=doc[ce]("input");elem20[sa]("type","text");var elem20_attr1="";elem20_attr1+="",elem20_attr1+=currentDefinition.system.axiom,elem20_attr1+="",elem20[sa]("value",elem20_attr1),elem12[ac](elem20);var elem22=doc[ce]("h2");elem12[ac](elem22),elem22[ac](doc[ct]("Iterations"));var elem25=doc[ce]("input");elem25[sa]("type","text");var elem25_attr1="";elem25_attr1+="",elem25_attr1+=currentDefinition.iterations,elem25_attr1+="",elem25[sa]("value",elem25_attr1),elem12[ac](elem25);var elem27=doc[ce]("h2");if(elem12[ac](elem27),elem27[ac](doc[ct]("Constants")),currentDefinition.system.constants){var elem30=doc[ce]("ul");elem30[sa]("class","constants"),elem12[ac](elem30),Object.keys(currentDefinition.system.constants).forEach(function(e){var t=doc[ce]("li");elem30[ac](t);var n=doc[ce]("input");n[sa]("type","text"),n[sa]("class","key");var i="";i+="",i+=e,i+="",n[sa]("value",i),t[ac](n);var r=doc[ce]("input");r[sa]("type","text");var o="";o+="",o+=currentDefinition.system.constants[e],o+="",r[sa]("value",o),t[ac](r)})}var elem40=doc[ce]("h2");if(elem12[ac](elem40),elem40[ac](doc[ct]("Rules")),currentDefinition.system.rules){var elem43=doc[ce]("ul");elem12[ac](elem43),Object.keys(currentDefinition.system.rules).forEach(function(e){var t=currentDefinition.system.rules[e],n=doc[ce]("li");elem43[ac](n);var i=doc[ce]("input");i[sa]("type","text"),i[sa]("class","key");var r="";if(r+="",r+=e,r+="",i[sa]("value",r),n[ac](i),"function"==typeof t){var o=doc[ce]("textarea");
n[ac](o),o[ac](doc[ct](t))}else{var s=doc[ce]("input");s[sa]("type","text");var a="";a+="",a+=t,a+="",s[sa]("value",a),n[ac](s)}})}}return fragment},blueprints._s.structure=function(data){var fragment=doc[cf]();with(data||{}){var elem1=doc[ce]("div");elem1[sa]("class","canvas-container"),fragment[ac](elem1);var elem3=doc[ce]("div");elem3[sa]("class","settings"),fragment[ac](elem3);var elem5=doc[ce]("div");elem5[sa]("class","lsystem-settings"),elem5[sa]("data-title","L-System"),elem3[ac](elem5);var elem7=doc[ce]("div");elem7[sa]("class","turtle-settings"),elem7[sa]("data-title","Turtle"),elem3[ac](elem7)}return fragment},blueprints._s["turtle-settings"]=function(data){var fragment=doc[cf]();with(data||{}){var elem0=doc[ce]("div");elem0[sa]("class","selector"),fragment[ac](elem0);var elem2=doc[ce]("label");elem2[sa]("for","turtleType"),elem0[ac](elem2),elem2[ac](doc[ct]("Pick the type of turtle to use when rendering: "));var elem5=doc[ce]("select");elem5[sa]("id","turtleType"),elem0[ac](elem5),turtles.forEach(function(e){var t=doc[ce]("option"),n="";n+="",n+=e,n+="",t[sa]("value",n),elem5[ac](t),t[ac](doc[ct](e))});var elem12=doc[ce]("div");elem12[sa]("class","definition"),fragment[ac](elem12);var elem14=doc[ce]("h1");elem12[ac](elem14),elem14[ac](doc[ct]("Initial State"));var elem17=doc[ce]("h2");elem12[ac](elem17),elem17[ac](doc[ct]("Orientation"));var elem20=doc[ce]("ul");elem12[ac](elem20),elem20[ac](blueprints("edit-vector",{name:"Position",vector:state.position})),elem20[ac](blueprints("edit-vector",{name:"Heading",vector:state.heading})),elem20[ac](blueprints("edit-vector",{name:"Left",vector:state.left})),elem20[ac](blueprints("edit-vector",{name:"Up",vector:state.up}));var elem23=doc[ce]("h2");elem12[ac](elem23),elem23[ac](doc[ct]("Defaults"));var elem26=doc[ce]("ul");elem12[ac](elem26);var elem28=doc[ce]("li");elem26[ac](elem28);var elem29=doc[ce]("h3");elem28[ac](elem29),elem29[ac](doc[ct]("Distance"));var elem31=doc[ce]("input");elem31[sa]("type","text");var elem31_attr1="";elem31_attr1+="",elem31_attr1+=state.defaultDistance,elem31_attr1+="",elem31[sa]("value",elem31_attr1),elem28[ac](elem31);var elem33=doc[ce]("li");elem26[ac](elem33);var elem34=doc[ce]("h3");elem33[ac](elem34),elem34[ac](doc[ct]("Angle"));var elem36=doc[ce]("input");elem36[sa]("type","text");var elem36_attr1="";elem36_attr1+="",elem36_attr1+=state.defaultAngle,elem36_attr1+="",elem36[sa]("value",elem36_attr1),elem33[ac](elem36);var elem39=doc[ce]("h2");elem12[ac](elem39),elem39[ac](doc[ct]("Styling"));var elem42=doc[ce]("ul");elem12[ac](elem42);var elem44=doc[ce]("li");elem42[ac](elem44);var elem45=doc[ce]("h3");elem44[ac](elem45),elem45[ac](doc[ct]("Line Width"));var elem47=doc[ce]("input");elem47[sa]("type","text");var elem47_attr1="";elem47_attr1+="",elem47_attr1+=state.lineWidth,elem47_attr1+="",elem47[sa]("value",elem47_attr1),elem44[ac](elem47);var elem50=doc[ce]("h2");elem12[ac](elem50),elem50[ac](doc[ct]("Tropism"));var elem53=doc[ce]("ul");elem53[sa]("class","tropism"),elem12[ac](elem53);var elem55=doc[ce]("li");elem53[ac](elem55);var elem56=doc[ce]("h3");elem55[ac](elem56),elem56[ac](doc[ct]("Enabled"));var elem58=doc[ce]("input");elem58[sa]("type","checkbox"),elem58[sa]("class","enabled");var elem58_attr2="";elem58_attr2+="",elem58_attr2+=state.tropismEnabled,elem58_attr2+="",elem58[sa]("value",elem58_attr2),elem55[ac](elem58);var elem60=doc[ce]("li");elem53[ac](elem60);var elem61=doc[ce]("h3");elem60[ac](elem61),elem61[ac](doc[ct]("Constant"));var elem63=doc[ce]("input");elem63[sa]("type","text"),elem63[sa]("class","constant");var elem63_attr2="";elem63_attr2+="",elem63_attr2+=state.tropismConstant,elem63_attr2+="",elem63[sa]("value",elem63_attr2),elem60[ac](elem63),elem53[ac](blueprints("edit-vector",{name:"Vector",vector:state.tropism}))}return fragment},window.blueprints=blueprints}(document),function(){function e(e,t){this._element=e,this._turtleType=t}e.prototype=Object.create(Subscribable.prototype),e.prototype.getTurtle=function(){return this._turtleType},e.prototype.getInitialState=function(){return this._initialState},e.prototype.setInitialState=function(e){this._initialState=e,this._render()},e.prototype._render=function(){var t=this._initialState.tropismEnabled;this._element.innerHTML="",this._element.appendChild(blueprints("turtle-settings",{turtles:Object.keys(e.TURTLES),state:this._initialState})),t?this._element.querySelector(".tropism .enabled").checked=!0:[].slice.call(document.querySelectorAll(".tropism .constant, .tropism .vector input")).forEach(function(e){e.disabled=!0}),this._turtleTypeElement=this._element.querySelector("#turtleType"),this._turtleTypeElement.addEventListener("change",this._changeTurtle.bind(this))},e.prototype._changeTurtle=function(){var t=this._turtleTypeElement.children[this._turtleTypeElement.selectedIndex].value;this._turtleType=e.TURTLES[t],this.fire("typeChanged")},e.TURTLES={Simple:L.Turtle.Simple,Recursive:L.Turtle.Recursive,Organic:L.Turtle.Organic},window.TurtleSettings=e}(),function(){function e(){i.clear(),t.getLSystem().iterate(t.getIterations(),function(e){r.startRecording(),new(n.getTurtle())(n.getInitialState().withPosition(i.width/2,i.height,0),L.turtle.fns).render(e,r,function(){r.stopRecording()})})}document.body.appendChild(blueprints("structure"));var t=(new Tweaker(document.querySelector(".settings")),new LSystemSettings(document.querySelector(".lsystem-settings"))),n=new TurtleSettings(document.querySelector(".turtle-settings"),L.Turtle.Simple),i=new DrawingBoard(document.querySelector(".canvas-container")),r=i.getContext();n.on("typeChanged",e),t.on("lsystemChanged",function(t){n.setInitialState(t.state),e()}),t.setDefinition(L.examples.tree)}();